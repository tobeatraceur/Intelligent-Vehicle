/********************************************Copyright******************************************************
**                                                                                                      
**
**-------------------------------------------文件信息-------------------------------------------------------
** 文件名称:			Wp_Ble.c
** 最后修订日期:  		2012-10-10
** 最后版本:			1.0
** 描述:				BLE模块操作文件;
**
**-----------------------------------------------------------------------------------------------------------
** 创建人:				吴康
** 创建日期:			2012-02-09
** 版本:				1.0
** 描述:				BLE模块操作文件;
**
**-----------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
** 版本:
** 描述:
**
**-----------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
** 版本:
** 描述:
**
*************************************************************************************************************/
#include "Wp_Ble.h"


/*************************************************************************************************************
** 函数名称:			Wp_BleKeyInit
**
** 函数描述:			BLE模块按键引脚初始化;
** 						
**					    
** 输入变量:			void;
** 返回值:				void;
**
** 使用宏或常量:		None;
** 使用全局变量:		None;
**
** 调用函数:			None;
**
** 创建人:				
** 创建日期:			2011-11-1
**-------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**-------------------------------------------------------------------------------------------------------------
***************************************************************************************************************/
void Wp_BleKeyInit(void)
{
	GPIO_InitTypeDef GPIO_InitStructure;
    
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOD, ENABLE);
    
	BLEMODE_L;
    
	/*  PD4作为BLE模式切换引脚  */
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_4;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;		// 推挽输出
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;		// 50M时钟速度
	GPIO_Init(GPIOD, &GPIO_InitStructure);					// GPIOD初始化
}


/*************************************************************************************************************
** 函数名称:			Wp_SetBleBaud
**
** 函数描述:			设置BLE模块波特率;
** 						
**					    
** 输入变量:			u8 baud;
** 返回值:				void;
**
** 使用宏或常量:		None;
** 使用全局变量:		None;
**
** 调用函数:			None;
**
** 创建人:				
** 创建日期:			2011-11-1
**-------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**-------------------------------------------------------------------------------------------------------------
***************************************************************************************************************/
void Wp_SetBleBaud(u8 baud)
{
    switch (baud)
    {
        case 4:
            Wp_Usart2_SendStr("AT+BAUD4");        // 设置模块波特率为115200bps
            break;
        case 8:
            Wp_Usart2_SendStr("AT+BAUD8");        // 设置模块波特率为230400bps
            break;
        default:
            break;
    }
}


/*************************************************************************************************************
** 函数名称:			Wp_SetBleBaud
**
** 函数描述:			设置BLE模块波特率;
** 						
**					    
** 输入变量:			char *str;
** 返回值:				void;
**
** 使用宏或常量:		None;
** 使用全局变量:		None;
**
** 调用函数:			None;
**
** 创建人:				
** 创建日期:			2011-11-1
**-------------------------------------------------------------------------------------------------------------
** 修订人:
** 修订日期:
**-------------------------------------------------------------------------------------------------------------
***************************************************************************************************************/
void Wp_SetBleName(char *str)
{
    char blename[18] = {0};                         // 最长18个字节
    
    strcpy(blename, "AT+NAME");
    strcat(blename, str);
    
//    strcpy(blename, "AT+NAME");                     // 测试使用，OK
//    strcat(blename, "wukangble");
    
    Wp_Usart2_SendStr(&blename[0]);                 // 设置名称
}


/********************************************************************************************************
**                            End Of File
********************************************************************************************************/
